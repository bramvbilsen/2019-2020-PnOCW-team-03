<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<title>transfromToBoundingBox</title>
</head>
<body>
<!-- <img id="img" src="test.png" alt="test" height="200" width="200"> -->
<canvas id="output" width="200" height="200"></canvas>
<h2>perspectiveTransform</h2>

<script src="opencv.js" type="text/javascript"></script>
<script type="text/javascript">
    function tranform(canvas, srcPoints, dstPoints) {
        let src = cv.imread(canvas);
        let dst = new cv.Mat();
        let dsize = new cv.Size(src.rows, src.cols);
        let srcTri = cv.matFromArray(4, 1, cv.CV_32FC2, [srcPoints[0].x, srcPoints[0].y, srcPoints[1].x, srcPoints[2].y, srcPoints[2].x, srcPoints[2].y,srcPoints[3].x, srcPoints[3].y]);
        let dstTri = cv.matFromArray(4, 1, cv.CV_32FC2, [dstPoints[0].x, dstPoints[0].y, dstPoints[1].x, dstPoints[2].y, dstPoints[2].x, dstPoints[2].y,dstPoints[3].x, dstPoints[3].y]);
        let M = cv.getPerspectiveTransform(srcTri, dstTri);
        cv.warpPerspective(src, dst, M, dsize, cv.INTER_LINEAR, cv.BORDER_CONSTANT, new cv.Scalar());
        var outputcanvas = createCanvas(200, 200);
        cv.imshow(outputcanvas, dst);
        src.delete(); dst.delete(); M.delete(); srcTri.delete(); dstTri.delete();
    }

    //example with hardcoded parameters, tranforms a small blue rectangle to fill the full canvas
    var resultingScreenCanvas = createCanvas(200, 200);
    var resultingScreenCtx = (resultingScreenCanvas.getContext("2d"));
    resultingScreenCtx.fillStyle = "rgb(120, 120, 255)";
    resultingScreenCtx.fillRect(50, 50, 100, 100);
    var ctx = resultingScreenCanvas.getContext("2d");
    var PixelData = ctx.getImageData(0, 0, resultingScreenCanvas.width, resultingScreenCanvas.height);
    let src = cv.imread(resultingScreenCanvas);
    let dst = new cv.Mat();
    let dsize = new cv.Size(src.rows, src.cols);
    let srcTri = cv.matFromArray(4, 1, cv.CV_32FC2, [50, 50, 150, 50, 50, 150, 150, 150]);
    let dstTri = cv.matFromArray(4, 1, cv.CV_32FC2, [0, 0, 200, 0, 0, 200, 200, 200]);
    let M = cv.getPerspectiveTransform(srcTri, dstTri);
    cv.warpPerspective(src, dst, M, dsize, cv.INTER_LINEAR, cv.BORDER_CONSTANT, new cv.Scalar());
    cv.imshow(output, dst);
    src.delete(); dst.delete(); M.delete(); srcTri.delete(); dstTri.delete();

    function createCanvas(width, height) {
    const canvas = document.createElement("canvas");
    canvas.width = width;
    canvas.height = height;
    return canvas;
}
</script>
</body>
</html>