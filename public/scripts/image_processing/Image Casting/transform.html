<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="style.css">
<title>Transform</title>
</head>
<body>


<img id="img" src="testfile.png"/>
<div class="crop">
    <img id="imgoutput" src="testfile.png" />
</div>
<canvas id="my-canvas" width="300px" height="200px" >
<canvas id="canvasoutput" width="300px" height="200px" >
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>

<script type="text/javascript">

const canvas = document.getElementById("my-canvas")
const context = canvas.getContext("2d")
const imgctx = new Image();
imgctx.src = "./testfile.png"
imgctx.onload = () => {  context.drawImage(img, 0, 0)}



// Computes the matrix3d that maps src points to dst.
function computeTransform(src, dst) {
  // src and dst should have length 4 each
  var count = 4;
  var a = []; // (2*count) x 8 matrix
  var b = []; // (2*count) vector

  for (var i = 0; i < 2 * count; ++i) {
    a.push([0, 0, 0, 0, 0, 0, 0, 0]);
    b.push(0);
  }

  for (var i = 0; i < count; ++i) {
    var j = i + count;
    a[i][0] = a[j][3] = src[i][0];
    a[i][1] = a[j][4] = src[i][1];
    a[i][2] = a[j][5] = 1;
    a[i][3] = a[i][4] = a[i][5] =
      a[j][0] = a[j][1] = a[j][2] = 0;
    a[i][6] = -src[i][0] * dst[i][0];
    a[i][7] = -src[i][1] * dst[i][0];
    a[j][6] = -src[i][0] * dst[i][1];
    a[j][7] = -src[i][1] * dst[i][1];
    b[i] = dst[i][0];
    b[j] = dst[i][1];
  }

  var x = numeric.solve(a, b);
  // matrix3d is homogeneous coords in column major!
  // the z coordinate is unused
  var m = [
    x[0], x[3],   0, x[6],
    x[1], x[4],   0, x[7],
       0,    0,   1,    0,
    x[2], x[5],   0,    1
  ];
  var transform = "matrix3d(";
  for (var i = 0; i < m.length - 1; ++i) {
    transform += m[i] + ", ";
  }
  transform += m[15] + ")";
  return transform;
}

// Collect the four corners
function applyTransform(dst, src) {
  if (dst.length == 4) {
    // Once we have all corners, compute the transform.
    var img = document.getElementById('imgoutput');
    var w = img.width,
        h = img.height;
    var transform = computeTransform(
      dst,
      src
    );
    
    document.getElementById('imgoutput').style.transformOrigin = '0 0';
    document.getElementById('imgoutput').style.transform = transform;
    document.getElementById('my-canvas').style.transformOrigin = '0 0';
    document.getElementById('my-canvas').style.transform = transform;
}
}

var dst = [[133, 12],[ 221, 49], [166, 184], [79, 148]];
var src = [[0, 0], [300, 0], [300, 200], [0, 200]];
applyTransform(dst, src);

 
</script>

</body>
</html>